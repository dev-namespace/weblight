{"code":"!function(e){var t={};function n(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(e,\"__esModule\",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&\"object\"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,\"default\",{enumerable:!0,value:e}),2&t&&\"string\"!=typeof e)for(var r in e)n.d(o,r,function(t){return e[t]}.bind(null,r));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,\"a\",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p=\"\",n(n.s=0)}([function(e,t,n){const o=n(1)();o.build();const r={},i={renderResults:e=>{o.renderResults(e)},printResults:e=>{console.log(e)}};function d(e){if(e.id)return`[id=\"${e.id}\"]`;if(\"body\"===e.tagName.toLowerCase())return e.tagName;const t=Array.from(e.parentNode.children).indexOf(e)+1;return`${d(e.parentNode)} > ${e.tagName}:nth-child(${t})`}chrome.runtime.onMessage.addListener((e,t,n)=>{\"command\"===e.type?i[e.command](...e.args):\"callback\"===e.type&&(r[e.cid](...e.args),delete r[e.cid])}),window.commandMsg=(e,t,n)=>{const o=n?Math.random().toString(36):void 0;n&&((e,t)=>r[e]=t)(o,n),chrome.runtime.sendMessage({type:\"command\",command:e,args:t,cid:o})};const s=(e,t)=>{const n=\"function\"==typeof t?t:e=>e[t];return[...e.reduce((e,t)=>{const o=null==t?t:n(t);return e.has(o)||e.set(o,t),e},new Map).values()]},c=e=>`${e}px`,a=(e=\"\",t=[],n)=>{const o=document.createElement(\"div\");return o.className=\"--highlight--\",o.innerHTML=e,t&&t.forEach(e=>o.appendChild(e)),Object.assign(o.style,n),o},l=(e,t)=>{const n=document.createElement(\"button\");return n.innerText=e,n.addEventListener(\"click\",t),Object.assign(n.style,{background:\"white\",color:\"#111\",padding:\"5px 10px\",border:\"2px solid black\",margin:c(2)}),n},u=e=>e.parentNode.removeChild(e);function m(e,{clientX:t,clientY:n}){const o=window.scrollX+t,r=window.scrollY+n;return new Promise(t=>{const n=e=>{\"w\"===e.key?d(!0):\"Escape\"!==e.key&&\"Esc\"!==e.key||d(!1)},i=e=>{[...e.path].includes(document.querySelector(\".--highlight--modal\"))||d(!1)},d=e=>{document.removeEventListener(\"mousedown\",i),document.removeEventListener(\"keydown\",n),u(s),t(e)},s=a(`<strong>${e}</strong><br/>`,[l(\"Cancel\",()=>d(!1)),l(\"OK\",()=>d(!0))],{background:\"#fefefe\",padding:c(20),position:\"absolute\",border:\"2px solid black\",top:c(r),left:c(o),zIndex:\"99999\",display:\"none\"});document.addEventListener(\"mousedown\",i),document.addEventListener(\"keydown\",n),s.classList.add(\"--highlight--modal\"),document.body.appendChild(s)})}function f(e){if(1===e.nodeType)return{type:1,path:d(e)};if(3!==e.nodeType)throw new Exception(\"Unknown node type\");const t=e.parentNode;return{type:3,index:Array.from(t.childNodes).indexOf(e),path:d(t)}}function g(e){const{type:t,index:n,path:o}=e,r=function(e){return document.querySelector(e)}(o);return 1===t?r:r.childNodes[n]}function h(e,t){return e.x<=t.x&&e.x+e.width>=t.x+t.width&&e.y<=t.y&&e.y+e.height>=t.y+t.height}function p({id:e,range:t}){let n;const o=function(e){const{startNode:t,startOffset:n,endNode:o,endOffset:r}=e,i=g(t),d=g(o),s=new Range;return s.setStart(i,n),s.setEnd(d,r),s}(t),r=Array.from(o.getClientRects()),i=r.reduce((e,t,n)=>e.some(e=>h(e,t))||r.slice(n+1).some(e=>h(e,t))?e:[...e,t],[]),d={x:window.scrollX,y:window.scrollY},s=async t=>{await m(\"Remove?\",t)&&(!function(e){x(b().filter(({id:t})=>t!==e)),commandMsg(\"removeHighlight\",[{id:e}])}(e),n.forEach(u))};n=i.map(e=>(function({x:e,y:t,width:n,height:o},r,i){const d=r.x-2,s=r.y-2,l=a(\"\",null,{left:c(d+e),top:c(s+t),zIndex:\"99999\",width:c(n),height:c(o),background:\"rgb(244, 241, 66, 0.2)\",position:\"absolute\",padding:\"4px 0\"});return l.addEventListener(\"click\",i),document.body.appendChild(l),l})(e,d,s))}function y(e,t){const n=function(e){const{startOffset:t,endOffset:n}=e;return{startNode:f(e.startContainer),startOffset:t,endNode:f(e.endContainer),endOffset:n}}(e),o=t,r={id:Math.random().toString(36),range:n,text:o};p(r),function({id:e,range:t,text:n}){const o={id:e,range:t,text:n};x([...b(),o])}(r),function({id:e,range:t,text:n}){const o={url:v,text:document.body.textContent,title:document.title};commandMsg(\"sendHighlight\",[{highlight:{id:e,range:t,text:n,url:v,indexable:!0},page:o}])}(r)}const w=\"highlights\",v=window.location.href;function b(){return JSON.parse(localStorage.getItem(w)||\"{}\")[v]||[]}function x(e){const t=JSON.parse(localStorage.getItem(w)||\"{}\");t[v]=e,localStorage.setItem(w,JSON.stringify(t))}async function E(){let e=b();{const t=await new Promise(e=>{commandMsg(\"queryHighlights\",[{url:v}],t=>{e(t.highlights)})});e=s([...e,...t],\"id\")}e.forEach(e=>{try{p(e)}catch(e){console.error(e)}})}document.addEventListener(\"mouseup\",async function e(t){const n=window.getSelection(),o=n.getRangeAt(0),r=n.toString();n.isCollapsed||(document.removeEventListener(\"mouseup\",e),await m(\"Highlight?\",t)&&(y(o,r),n.empty()),setTimeout(()=>document.addEventListener(\"mouseup\",e),100))}),window.addEventListener(\"load\",()=>setTimeout(E,100)),window.addEventListener(\"resize\",((e,t)=>{let n;return(...o)=>{clearTimeout(n),n=setTimeout(()=>t(...o),e)}})(10,()=>{const e=document.querySelectorAll(\".--highlight--\");Array.from(e).forEach(u),E()}))},function(e,t,n){\"use strict\";n.r(t),n.d(t,\"Modal\",function(){return i});const o=(e,t)=>{let n;return(...o)=>{clearTimeout(n),n=setTimeout(()=>t(...o),e)}},r=(e,t,n,o=\"\")=>{const r=document.createElement(e);return r.classList.add(...t),r.innerHTML=o,n&&n.appendChild(r),r};function i(){function e(e){modal.results.innerHTML=\"\",e.results.sort((e,t)=>t.score-e.score),e.results.forEach(e=>{console.log(\"result\",e);const t=r(\"div\",[\"wl-modal--page\"],modal.results),n=r(\"div\",[\"wl-modal--page--header\"],t),o=r(\"div\",[\"wl-modal--result--icon\"],n);r(\"img\",[],o).src=`https://plus.google.com/_/favicon?domain_url=${e._id}`;r(\"span\",[\"wl-modal--page--header--text\"],n,e.title.slice(0,45)),r(\"a\",[],n);const i=r(\"div\",[],t);t.onclick=()=>(function(e,t){if(t.visible)return e.innerHTML=\"\",void(t.visible=!1);(function(e,t){t.highlights.forEach(t=>{console.log(\"hl\",t);const n=r(\"a\",[],e),o=r(\"div\",[\"wl-modal--result\"],n);r(\"span\",[\"wl-modal--result--text\"],o,t.text);n.href=t.url})})(e,t),t.visible=!0})(i,e)})}return{build:function(){document.addEventListener(\"keydown\",t=>{\"o\"===t.key&&t.altKey&&function(){if(modal)return modal.container.classList.toggle(\"hidden\"),void(modal.container.classList.contains(\"hidden\")||modal.search.focus());const t=r(\"div\",[\"wl-modal--container\"],document.body),n=r(\"input\",[\"wl-modal--search\"],t),i=r(\"div\",[\"wl-modal--results\"],t);n.onkeyup=o(100,t=>{n.value.length>3&&commandMsg(\"searchHighlights\",[{search:n.value}],e)}),modal={container:t,search:n,results:i},modal.search.focus()}()})},renderResults:e}}t.default=i}]);","extractedComments":[]}